<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>todo.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Todo.html">Todo</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#colorChange">colorChange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createBlank">createBlank</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#dayColorChange">dayColorChange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fillDays">fillDays</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fillMonths">fillMonths</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fillMonthsHelper">fillMonthsHelper</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#lightOrDark">lightOrDark</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#logout">logout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#PageLoaded">PageLoaded</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateCalendar">populateCalendar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#progress_func">progress_func</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderData">renderData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setCurrDate">setCurrDate</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">todo.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const todoContainer = document.getElementById("todo-container");

// checking if user is signed in or not
auth.onAuthStateChanged((user) => {
  if (!user) {
    location = "login.html";
  }
});

/**
 * Todo example class
 * @constructor
 */
class Todo {
  constructor(id, text) {
    this.id = id;
    this.text = text;
  }
  toString() {
    return this.text;
  }
}

// Firestore data converter
var todoConverter = {
  toFirestore: function (todo) {
    return {
      id: todo.id,
      text: todo.text,
    };
  },
  fromFirestore: function (snapshot, options) {
    const data = snapshot.data(options);
    return new Todo(data.id, data.text);
  },
};

/**
 * Function to render data from a doc
 * @param {FirestoreDoc} individualDoc - Individual firestore doc
 */
function renderData(individualDoc) {
  // parent div
  let parentDiv = document.createElement("div");
  parentDiv.className = "container todo-box";
  parentDiv.setAttribute("data-id", individualDoc.id);

  // task div
  let taskDiv = document.createElement("div");
  taskDiv.textContent = individualDoc.data().text;

  // button
  let trash = document.createElement("button");

  let i = document.createElement("i");
  i.className = "fas fa-trash";

  // appending
  trash.appendChild(i);

  parentDiv.appendChild(taskDiv);
  parentDiv.appendChild(trash);

  todoContainer.appendChild(parentDiv);

  // trash clicking event
  trash.addEventListener("click", (e) => {
    let id = e.target.parentElement.parentElement.getAttribute("data-id");
    auth.onAuthStateChanged((user) => {
      if (user) {
        fs.collection("users")
          .doc(user.uid)
          .collection("tasks")
          .doc(id)
          .delete();
      }
    });
  });
}

// retriving username
auth.onAuthStateChanged((user) => {
  const username = document.getElementById("username");
  if (user) {
    fs.collection("users")
      .doc(user.uid)
      .get()
      .then((snapshot) => {
        username.innerText = snapshot.data().name;
      });
  }
});

// adding tasks to firestore database
const form = document.getElementById("form");
let date = new Date();
let time = date.getTime();
let counter = time;
form.addEventListener("submit", (e) => {
  e.preventDefault();
  const todos = form["todos"].value;
  let id = (counter += 1);
  form.reset();
  auth.onAuthStateChanged((user) => {
    if (user) {
      fs.collection("users")
        .doc(user.uid)
        .collection("tasks")
        .doc("_" + id)
        .withConverter(todoConverter)
        .set(new Todo(id, todos))
        .then(() => {
          console.log("todo added");
        })
        .catch((err) => {
          console.log(err.message);
        });
    }
  });
});

/**
 * Function to log out user
 */
function logout() {
  auth.signOut();
}

// realtime listners
auth.onAuthStateChanged((user) => {
  if (user) {
    fs.collection("users")
      .doc(user.uid)
      .collection("tasks")
      .onSnapshot((snapshot) => {
        let changes = snapshot.docChanges();
        changes.forEach((change) => {
          if (change.type == "added") {
            renderData(change.doc);
          } else if (change.type == "removed") {
            let li = todoContainer.querySelector(
              "[data-id=" + change.doc.id + "]"
            );
            todoContainer.removeChild(li);
          }
        });
      });
  }
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Mon May 17 2021 22:17:39 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
