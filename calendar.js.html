<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>calendar.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="BujoElement.html">BujoElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BujoElement.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="BujoElement.html#sync">sync</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ProgressTracker.html">ProgressTracker</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ProgressTracker.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ProgressTracker.html#sync">sync</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#btn">btn</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#cal_date">cal_date</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#colorChange">colorChange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createBlank">createBlank</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#dayColorChange">dayColorChange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#daysIntoYear">daysIntoYear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#doyToDate">doyToDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#dynamicallyLoadScript">dynamicallyLoadScript</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fillDays">fillDays</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fillMonths">fillMonths</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fillMonthsHelper">fillMonthsHelper</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#lightOrDark">lightOrDark</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#loadAllPages">loadAllPages</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#loadPage">loadPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#logout">logout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#main">main</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NavbarLoaded">NavbarLoaded</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#overlayOff">overlayOff</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#overlayOn">overlayOn</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#PageLoaded">PageLoaded</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#PageUnloaded">PageUnloaded</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#populateCalendar">populateCalendar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#progress_func">progress_func</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#renderData">renderData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#resize">resize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#save">save</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#select">select</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setCurrDate">setCurrDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setIcon">setIcon</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setLevel">setLevel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setSignifier">setSignifier</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setStyle">setStyle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#setType">setType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#unloadScripts">unloadScripts</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#update_bar">update_bar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#update_progress">update_progress</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateNavbar">updateNavbar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateStyle">updateStyle</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">calendar.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>PROGRESS_BAR = "week-bar";
WEEK = document.getElementById("weeks");
document.getElementById(PROGRESS_BAR).style.width = `${0}%`;

$("#datepicker1").datepicker();
$("#datepicker2").datepicker();

auth.onAuthStateChanged((user) => {
  PageLoaded();
  fs.collection("users")
    .doc(user.uid)
    .collection("settings")
    .doc("calendar")
    .onSnapshot((doc) => {
      try {
        var semester_start = doc.data().semester_start.toDate();
        var semester_end = doc.data().semester_end.toDate();
        $("#datepicker1").datepicker("update", semester_start);
        $("#datepicker2").datepicker("update", semester_end);
        progress_func();
      } catch (err) {
        console.log(err);
      }
    });
});

/**
 * Calculate the progress based on the start and end dates
 * @param {Date} start starting date
 * @param {Date} end ending date
 * @returns Array containing progress in percentage and the number of weeks
 *     since start
 */
function cal_date(start, end) {
  let today = daysIntoYear(new Date());
  let date_diff = end - start;
  let weeks = Math.round((today - start) / 7);
  let progress = (today - start) / date_diff;
  progress = Math.round(progress * 100);
  return [progress, weeks];
}

/**
 * Function to update the given bar
 * @param {string} id bar to update
 * @param {int} value percentage of bar
 */
function update_bar(id, value) {
  let element = document.getElementById(id);
  if (value > 100) {
    value = 100;
  }
  if (value &lt;= 5) {
    element.style.backgroundColor = "red";
  } else if (value &lt;= 25 &amp;&amp; value > 5) {
    element.style.backgroundColor = "orange";
  } else if (value &lt;= 50 &amp;&amp; value > 25) {
    element.style.backgroundColor = "gold";
  } else if (value &lt;= 75 &amp;&amp; value > 50) {
    element.style.backgroundColor = "yellow";
  } else {
    element.style.backgroundColor = "#86e01e";
  }
  element.style.width = `${value}%`;
}

/**
 * When user creates a new progress, this function will be called and bind the
 * date picker
 * @param {string} id id of progress tracker
 */
function update_progress(id) {
  const select_start = "#start_" + id;
  const select_end = "#end_" + id;
  $(select_start).bind("change", function () {
    select(id);
    let text = $("#" + id).attr("text");
    let start_date = parseInt(
      daysIntoYear($("#start_" + id).datepicker("getDate"))
    );
    let end_date = parseInt($("#" + id).attr("end"));
    let progress = new ProgressTracker(id, text, start_date, end_date);
    progress.sync();
    $("#" + id).attr("start", start_date);
  });
  $(select_end).bind("change", function () {
    select(id);
    let text = $("#" + id).attr("text");
    let end_date = parseInt(
      daysIntoYear($("#end_" + id).datepicker("getDate"))
    );
    let start_date = parseInt($("#" + id).attr("start"));
    let progress = new ProgressTracker(id, text, start_date, end_date);
    progress.sync();
    $("#" + id).attr("end", end_date);
  });
}

/**
 * Function to get start and end dates and update progress bar
 * @param {string} id id of progress tracker
 */
function select(id) {
  let start_date = parseInt(
    daysIntoYear($("#start_" + id).datepicker("getDate"))
  );
  let end_date = parseInt(daysIntoYear($("#end_" + id).datepicker("getDate")));
  if (
    end_date != undefined &amp;&amp;
    start_date != undefined &amp;&amp;
    start_date &lt;= end_date
  ) {
    const response = cal_date(start_date, end_date);
    update_bar("bar_" + id, response[0]);
  }
}

/**
 * Function to delete a progress tracker
 * @param {HTMLElement} button delete button
 * @param {HTMLElement} element progress tracker to remove
 */
function btn(button, element) {
  button.addEventListener("click", () => {
    let id = element.getAttribute("id");
    let progress = new ProgressTracker(id, "", 0, 0);
    progress.delete();
  });
}

/**
 * Function to update the main tracker
 */
function progress_func() {
  var semester_start = $("#datepicker1").datepicker("getDate");
  var semester_end = $("#datepicker2").datepicker("getDate");
  auth.onAuthStateChanged((user) => {
    fs.collection("users")
      .doc(user.uid)
      .collection("settings")
      .doc("calendar")
      .set({ semester_start: semester_start, semester_end: semester_end });
  });
  if (semester_end != undefined &amp;&amp; semester_start != undefined) {
    var response = cal_date(
      daysIntoYear(semester_start),
      daysIntoYear(semester_end)
    );
    var text = "Welcome to Week " + response[1] + "!" + "😊";
    update_bar(PROGRESS_BAR, response[0]);
    WEEK.innerHTML = text;
  }
}

$("#datepicker1")
  .datepicker()
  .on("changeDate", function (ev) {
    progress_func();
  });

$("#datepicker2")
  .datepicker()
  .on("changeDate", function (ev) {
    progress_func();
  });

/**
 * Function to render progress data from a doc
 * @param {FirestoreDoc} individualDoc - Individual firestore doc
 */
function renderData(individualDoc) {
  let progress = progressConverter.fromFirestore(individualDoc);
  let id = progress.id;
  let text = progress.text;
  let start = parseInt(progress.start);
  let end = parseInt(progress.end);

  const progress_section = document.getElementById("progress-section");
  const new_progress = document.createElement("div");
  new_progress.setAttribute("class", "new_progress");
  new_progress.setAttribute("id", id);
  new_progress.setAttribute("text", text);
  new_progress.setAttribute("start", start);
  new_progress.setAttribute("end", end);

  const title = document.createElement("h2");
  title.contentEditable = true;
  title.innerHTML = text;

  const bar = document.createElement("div");
  bar.setAttribute("class", "progress");
  const bar_content = document.createElement("div");
  bar_content.setAttribute("id", "bar_" + id);
  bar_content.setAttribute("class", "progress-bar");
  bar_content.setAttribute("role", "progressbar");
  bar_content.setAttribute("style", "width: 100%");
  bar_content.setAttribute("aria-valuenow", "0");
  bar_content.setAttribute("aria-valuemin", "0");
  bar_content.setAttribute("aria-valuemax", "100");
  bar.appendChild(bar_content);

  const start_p = document.createElement("p");
  start_p.innerHTML = "Start:";
  const start_input = document.createElement("input");
  start_input.setAttribute("class", "form-control");
  start_input.setAttribute("id", "start_" + id);
  start_input.setAttribute("data-provide", "datepicker");
  start_input.setAttribute("style", "width: 110px");
  start_p.appendChild(start_input);

  const end_p = document.createElement("p");
  end_p.innerText = "End:";
  const end_input = document.createElement("input");
  end_input.setAttribute("class", "form-control");
  end_input.setAttribute("id", "end_" + id);
  end_input.setAttribute("data-provide", "datepicker");
  end_input.setAttribute("style", "width: 110px");
  end_p.appendChild(end_input);

  const btn_remove = document.createElement("a");
  btn_remove.setAttribute("class", "button-remove");
  btn_remove.innerHTML = "Delete";

  new_progress.appendChild(document.createElement("br"));
  new_progress.appendChild(title);
  new_progress.appendChild(bar);
  new_progress.appendChild(document.createElement("br"));
  new_progress.appendChild(start_p);
  new_progress.appendChild(end_p);
  new_progress.appendChild(btn_remove);
  progress_section.appendChild(new_progress);

  $("#start_" + id).datepicker();
  $("#start_" + id).datepicker("update", doyToDate(start, year));
  $("#end_" + id).datepicker();
  $("#end_" + id).datepicker("update", doyToDate(end, year));

  let response = cal_date(start, end);
  update_bar("bar_" + id, response[0]);
  update_progress(id);
  btn(btn_remove, new_progress);
}

// realtime listners
auth.onAuthStateChanged((user) => {
  if (user) {
    fs.collection("users")
      .doc(user.uid)
      .collection("data")
      .doc("progress")
      .collection("progress")
      .onSnapshot((snapshot) => {
        let changes = snapshot.docChanges();
        let progress_section = document.getElementById("progress-section");
        changes.forEach((change) => {
          if (change.type == "added") {
            if (
              dailyLog.querySelector('[id="' + change.doc.id + '"]') == null
            ) {
              renderData(change.doc);
            }
          } else if (change.type == "removed") {
            let progress = progress_section.querySelector(
              '[id="' + change.doc.id + '"]'
            );
            if (
              progress_section.querySelector('[id="' + change.doc.id + '"]') !=
              null
            ) {
              progress_section.removeChild(progress);
            }
          }
        });
      });
  }
});

// Open the modal
document.getElementById("button-add").addEventListener("click", () => {
  document.querySelector(".modal").style.display = "flex";
  $("#newstartdate").datepicker();
  $("#newenddate").datepicker();
});

// Close the modal
document.querySelector(".close").addEventListener("click", () => {
  document.querySelector(".modal").style.display = "none";
});

// Submit the progress
document.getElementById("button-submit").addEventListener("click", () => {
  let id = new Date().getTime();
  let text = document.getElementById("newproresstitle").value;
  let start = daysIntoYear($("#newstartdate").datepicker("getDate"));
  let end = daysIntoYear($("#newenddate").datepicker("getDate"));
  let progress = new ProgressTracker(id, text, start, end);
  progress.sync();
  document.querySelector(".modal").style.display = "none";
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sat Jun 05 2021 01:34:08 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
